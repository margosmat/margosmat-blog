---
import Layout from '../../../layouts/Layout.astro';
import Tile from '../../../components/Tile';
import { getCollection } from 'astro:content';

export function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'pl' } },
  ];
}

const { lang } = Astro.params;

const allPosts = await getCollection('blog');
const posts = allPosts
  .filter(post => post.data.lang === lang)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const title = lang === 'en' ? "Blog" : "Blog";
const backText = lang === 'en' ? "Back to Home" : "Powr√≥t";
---

<Layout title={`${title} - Mateusz Margos`} lang={lang as string}>
  <main class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div class="max-w-4xl w-full mb-8">
        <a href={`/${lang}`} class="text-foreground/60 hover:text-foreground font-medium mb-4 inline-block">&larr; {backText}</a>
        <h1 class="text-4xl font-bold">{title}</h1>
    </div>

    <div class="max-w-4xl w-full grid grid-cols-1 md:grid-cols-2 gap-6">
      {posts.map(post => (
        <a href={`/${lang}/blog/${post.slug}`}>
          <Tile className="h-64 flex flex-col justify-between" hoverColor="orange">
            <div>
                <h2 class="text-2xl font-bold mb-2 break-words">{post.data.title}</h2>
                <p class="text-foreground/70 line-clamp-3">{post.data.description}</p>
            </div>
            <div class="flex justify-between items-end mt-4">
                <span class="text-sm font-medium opacity-60">
                    {post.data.pubDate.toLocaleDateString(lang, { year: 'numeric', month: 'long', day: 'numeric' })}
                </span>
            </div>
          </Tile>
        </a>
      ))}
      
      {posts.length === 0 && (
        <div class="col-span-full text-center py-12 opacity-60">
            No posts found.
        </div>
      )}
    </div>
  </main>
</Layout>
